<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>STLL: Drawing the layouts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STLL
   &#160;<span id="projectnumber">0.0</span>
   </div>
   <div id="projectbrief">Simple Text Layouting Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('drawing_pg.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Drawing the layouts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When it comes to drawing the final layout there are quite some choices to make. This page will try to explain some of the available options.</p>
<p>Not all output drivers will support all the available options. Please read there for further information</p>
<h1><a class="anchor" id="gamma_sec"></a>
Gamma</h1>
<p>Some output drivers support gamma correct blending when drawing. That means they can be used to draw onto surfaces that do have a non linear intensity curve.</p>
<p>Most consumer level displays do have a non linear intensity curve, that means that the grey with the intensity values 128 is not half as bright as the one with intensity 255.</p>
<p>This has repercussions on blending. When not correctly done it will result in black shadows along blend lines and in letters that appear too thin.</p>
<p>To resolve this problem use the following rules:</p><ul>
<li>when drawing into a display buffer use the gamma value of 2.2</li>
<li>when drawing into non display buffers use gamma 1 (but make sure that you properly blend when you draw that buffer onto the surface</li>
</ul>
<p>The SDL output driver provides gamma values for output. OpenGL provides the possibility to set framebuffers to sRGB which results in proper blending when drawn into.</p>
<h1><a class="anchor" id="subpixel_sec"></a>
Sub pixel placement</h1>
<p>Sub pixel placement allows more accurate placement of pixels onto the screen. It requires a 1:1 correspondence between the framebuffer and the display, so it doesn't work on CRTs and it also doesn't work when the display has to scale the framebuffer.</p>
<p>But when all conditions are met you will get a sharper result and more evenly distributed letters.</p>
<p>The output routines need to know the sub pixel arrangement to make the right drawing decisions. If you can not find out and don't want to ask the user for that information don't use it. When used wrongly it will result in ugly output.</p>
<p>Also keep in mind that drawing with sub pixel placement is not possible on surfaces that include an alpha channel because the resulting surface can not properly drawn onto any other surface. This would require separate alpha channel for each colour component.</p>
<p>Sub pixel drawing only properly works when drawing directly onto the target. When drawing onto surfaces with an alpha channel, the alpha of all the pixels are untouched assuming that the background is properly prepared for the glyphs (e.g. opaque)</p>
<h1><a class="anchor" id="outputclasses_sec"></a>
Output Classes</h1>
<p>Output functions are always a member of a class. These classes encapsulate the state for drawing, but more importantly they encapsulate the glyph cache.</p>
<p>The glyph cache is there to avoid unnecessary re-rasterization of the glyphs. Each output class might come with its own type of cache.</p>
<p>When you want to draw you create an instance of those classes and then use the draw function of that instance.</p>
<h1><a class="anchor" id="opengl_sec"></a>
OpenGL drawing</h1>
<p>The OpenGL output class is a bit different from the usual C++ code, as it requires you to include the OpenGL header of your choice <em>before</em> you include the header for this module.</p>
<p>This is so because there is no proper header and each project might choose a different extension wrangler.</p>
<p>The class has a template argument V with which you choose your OpenGL version.</p><ul>
<li>1 results in an output class for OpenGL up to version 1.1. It uses the fixed function pipeline and display lists. Sub-pixel placement requires 3 drawing passes</li>
<li>1 creates the output class for OpenGL 2.0 - 2.1. It uses vertex buffers and shaders for output. It also requires 3 drawing passes for sub-pixel drawing</li>
<li>3 finally is intended OpenGL starting with version 3.0. It uses vertex array objects and the ARB_BlendFuncExtended extension for single pass sub-pixel placement</li>
</ul>
<p>All 3 OpenGL output classes use the same type of glyph-cache: a texture atlas. The functions will place as many glyphs of the layout to show into the atlas, output that portion, wipe the atlas and refill it with the next batch until it is filled again and so on. So it is important for performance to have a texture atlas that is big enough to hold all required glyphs.</p>
<p>You can specify 2 sizes for the texture atlas: an initial size and a maximal size. The output class will create square textures of the given sizes starting with the initial size and doubling that until it reached at least the maximal size (it might end up with a bigger size).</p>
<p>The OpenGL output classes can work with a cache object that stores information to quickly draw a layout. This class has a different content depending on the chosen OpenGL version, so it is kept opaque for the user Create an instance of this class and give a pointer to this instance to the drawing function. It will then fill the cache in such a way that redrawing the same layout later on (even at a different position) will be much faster (twice usually). You need a separate instance of this class for each layout and you need to make sure on your own, that the class is deleted, when the layout changes. Once the cache is filled the show function will always draw the same, independent of the layout.</p>
<p>The drawing function will invalidate the cache and recreate it though, when the texture cache has changed. Size increasing will be handled without drawing cache invalidation, but when the cache had to be flushed all existing drawing caches are invalid.</p>
<p>A few tips regarding texture atlas usage:</p><ul>
<li>stay away from blurr, it occupies quite a bit more space than a normal glyph. It also requires underlines to be within the cache. At a minimum keep the blurr very small</li>
<li>sub-pixel output requires 3 times as much space as normal anti-aliased output</li>
<li>you can get a pointer to the cache with the getData funtion to see how much is occupied</li>
</ul>
<p>TODO list touched state. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Jan 31 2016 18:06:00 for STLL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
